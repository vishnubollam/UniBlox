"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const { SageMakerRuntimeClient, InvokeEndpointCommand } = require('@aws-sdk/client-sagemaker-runtime');
const client = new SageMakerRuntimeClient({ region: process.env.AWS_REGION || 'us-east-1' });
exports.handler = async (event) => {
    const endpointName = process.env.SAGEMAKER_ENDPOINT || 'flask-endpoint';
    try {
        if (!event?.body) {
            return createResponse(400, { error: 'No request body provided' });
        }
        let body;
        try {
            body = JSON.parse(event.body);
        }
        catch (parseError) {
            return createResponse(400, { error: 'Invalid JSON in request body' });
        }
        const text = body.text;
        console.log('Input text:', text, 'Type:', typeof text);
        if (!text || typeof text !== 'string') {
            return createResponse(400, { error: 'Text must be a string' });
        }
        if (!isNaN(Number(text)) && text.trim() !== '') {
            return createResponse(400, { error: 'Text must not be a number' });
        }
        const payload = Buffer.from(JSON.stringify({ text }));
        const command = new InvokeEndpointCommand({
            EndpointName: endpointName,
            Body: payload,
            ContentType: 'application/json',
            Accept: 'application/json',
        });
        console.log('Invoking SageMaker endpoint:', endpointName);
        const result = await client.send(command);
        const response = JSON.parse(new TextDecoder().decode(result.Body));
        return createResponse(200, { result: response });
    }
    catch (error) {
        // Explicitly handle the 'unknown' type
        let errorMessage;
        if (error instanceof Error) {
            errorMessage = error.message;
        }
        else {
            errorMessage = String(error) || 'Unknown error';
        }
        console.error('Error invoking SageMaker endpoint:', error);
        return createResponse(500, {
            error: 'Failed to invoke model',
            details: errorMessage,
        });
    }
};
function createResponse(statusCode, body) {
    return {
        statusCode,
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body),
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJpbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQWFBLE1BQU0sRUFBRSxzQkFBc0IsRUFBRSxxQkFBcUIsRUFBRSxHQUFHLE9BQU8sQ0FBQyxtQ0FBbUMsQ0FBQyxDQUFDO0FBRXZHLE1BQU0sTUFBTSxHQUFHLElBQUksc0JBQXNCLENBQUMsRUFBRSxNQUFNLEVBQUUsT0FBTyxDQUFDLEdBQUcsQ0FBQyxVQUFVLElBQUksV0FBVyxFQUFFLENBQUMsQ0FBQztBQUU3RixPQUFPLENBQUMsT0FBTyxHQUFHLEtBQUssRUFBRSxLQUFtQixFQUEyQixFQUFFO0lBQ3ZFLE1BQU0sWUFBWSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsa0JBQWtCLElBQUksZ0JBQWdCLENBQUM7SUFFeEUsSUFBSSxDQUFDO1FBQ0gsSUFBSSxDQUFDLEtBQUssRUFBRSxJQUFJLEVBQUUsQ0FBQztZQUNqQixPQUFPLGNBQWMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxLQUFLLEVBQUUsMEJBQTBCLEVBQUUsQ0FBQyxDQUFDO1FBQ3BFLENBQUM7UUFFRCxJQUFJLElBQXNCLENBQUM7UUFDM0IsSUFBSSxDQUFDO1lBQ0gsSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsS0FBSyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ2hDLENBQUM7UUFBQyxPQUFPLFVBQVUsRUFBRSxDQUFDO1lBQ3BCLE9BQU8sY0FBYyxDQUFDLEdBQUcsRUFBRSxFQUFFLEtBQUssRUFBRSw4QkFBOEIsRUFBRSxDQUFDLENBQUM7UUFDeEUsQ0FBQztRQUNELE1BQU0sSUFBSSxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUM7UUFDdkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxhQUFhLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxPQUFPLElBQUksQ0FBQyxDQUFDO1FBR3ZELElBQUksQ0FBQyxJQUFJLElBQUksT0FBTyxJQUFJLEtBQUssUUFBUSxFQUFFLENBQUM7WUFDdEMsT0FBTyxjQUFjLENBQUMsR0FBRyxFQUFFLEVBQUUsS0FBSyxFQUFFLHVCQUF1QixFQUFFLENBQUMsQ0FBQztRQUNqRSxDQUFDO1FBQ0QsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsSUFBSSxJQUFJLENBQUMsSUFBSSxFQUFFLEtBQUssRUFBRSxFQUFFLENBQUM7WUFDL0MsT0FBTyxjQUFjLENBQUMsR0FBRyxFQUFFLEVBQUUsS0FBSyxFQUFFLDJCQUEyQixFQUFFLENBQUMsQ0FBQztRQUNyRSxDQUFDO1FBRUQsTUFBTSxPQUFPLEdBQUcsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBRXRELE1BQU0sT0FBTyxHQUFHLElBQUkscUJBQXFCLENBQUM7WUFDeEMsWUFBWSxFQUFFLFlBQVk7WUFDMUIsSUFBSSxFQUFFLE9BQU87WUFDYixXQUFXLEVBQUUsa0JBQWtCO1lBQy9CLE1BQU0sRUFBRSxrQkFBa0I7U0FDM0IsQ0FBQyxDQUFDO1FBRUgsT0FBTyxDQUFDLEdBQUcsQ0FBQyw4QkFBOEIsRUFBRSxZQUFZLENBQUMsQ0FBQztRQUMxRCxNQUFNLE1BQU0sR0FBRyxNQUFNLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDMUMsTUFBTSxRQUFRLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxJQUFJLFdBQVcsRUFBRSxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQztRQUVuRSxPQUFPLGNBQWMsQ0FBQyxHQUFHLEVBQUUsRUFBRSxNQUFNLEVBQUUsUUFBUSxFQUFFLENBQUMsQ0FBQztJQUVuRCxDQUFDO0lBRUQsT0FBTyxLQUFjLEVBQUUsQ0FBQztRQUN0Qix1Q0FBdUM7UUFDdkMsSUFBSSxZQUFvQixDQUFDO1FBQ3pCLElBQUksS0FBSyxZQUFZLEtBQUssRUFBRSxDQUFDO1lBQzNCLFlBQVksR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDO1FBQy9CLENBQUM7YUFBTSxDQUFDO1lBQ04sWUFBWSxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsSUFBSSxlQUFlLENBQUM7UUFDbEQsQ0FBQztRQUVELE9BQU8sQ0FBQyxLQUFLLENBQUMsb0NBQW9DLEVBQUUsS0FBSyxDQUFDLENBQUM7UUFDM0QsT0FBTyxjQUFjLENBQUMsR0FBRyxFQUFFO1lBQ3pCLEtBQUssRUFBRSx3QkFBd0I7WUFDL0IsT0FBTyxFQUFFLFlBQVk7U0FDdEIsQ0FBQyxDQUFDO0lBQ0wsQ0FBQztBQUNILENBQUMsQ0FBQztBQUVGLFNBQVMsY0FBYyxDQUFDLFVBQWtCLEVBQUUsSUFBc0Q7SUFDaEcsT0FBTztRQUNMLFVBQVU7UUFDVixPQUFPLEVBQUUsRUFBRSxjQUFjLEVBQUUsa0JBQWtCLEVBQUU7UUFDL0MsSUFBSSxFQUFFLElBQUksQ0FBQyxTQUFTLENBQUMsSUFBSSxDQUFDO0tBQzNCLENBQUM7QUFDSixDQUFDO0FBR0Q7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0lBd0RJIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQVBJR2F0ZXdheVByb3h5RXZlbnQsIEFQSUdhdGV3YXlQcm94eVJlc3VsdCB9IGZyb20gXCJhd3MtbGFtYmRhXCI7XG5cbmludGVyZmFjZSBMYW1iZGFFdmVudCB7XG4gIGJvZHk6IHN0cmluZztcbn1cblxuLy8gRGVmaW5lIHRoZSByZXNwb25zZSB0eXBlIGZvciBMYW1iZGFcbmludGVyZmFjZSBMYW1iZGFSZXNwb25zZSB7XG4gIHN0YXR1c0NvZGU6IG51bWJlcjtcbiAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogc3RyaW5nIH07XG4gIGJvZHk6IHN0cmluZztcbn1cblxuY29uc3QgeyBTYWdlTWFrZXJSdW50aW1lQ2xpZW50LCBJbnZva2VFbmRwb2ludENvbW1hbmQgfSA9IHJlcXVpcmUoJ0Bhd3Mtc2RrL2NsaWVudC1zYWdlbWFrZXItcnVudGltZScpO1xuXG5jb25zdCBjbGllbnQgPSBuZXcgU2FnZU1ha2VyUnVudGltZUNsaWVudCh7IHJlZ2lvbjogcHJvY2Vzcy5lbnYuQVdTX1JFR0lPTiB8fCAndXMtZWFzdC0xJyB9KTtcblxuZXhwb3J0cy5oYW5kbGVyID0gYXN5bmMgKGV2ZW50IDogTGFtYmRhRXZlbnQpOiBQcm9taXNlPExhbWJkYVJlc3BvbnNlPiA9PiB7XG4gIGNvbnN0IGVuZHBvaW50TmFtZSA9IHByb2Nlc3MuZW52LlNBR0VNQUtFUl9FTkRQT0lOVCB8fCAnZmxhc2stZW5kcG9pbnQnO1xuXG4gIHRyeSB7XG4gICAgaWYgKCFldmVudD8uYm9keSkge1xuICAgICAgcmV0dXJuIGNyZWF0ZVJlc3BvbnNlKDQwMCwgeyBlcnJvcjogJ05vIHJlcXVlc3QgYm9keSBwcm92aWRlZCcgfSk7XG4gICAgfVxuXG4gICAgbGV0IGJvZHkgOnt0ZXh0IDogc3RyaW5nIH07XG4gICAgdHJ5IHtcbiAgICAgIGJvZHkgPSBKU09OLnBhcnNlKGV2ZW50LmJvZHkpO1xuICAgIH0gY2F0Y2ggKHBhcnNlRXJyb3IpIHtcbiAgICAgIHJldHVybiBjcmVhdGVSZXNwb25zZSg0MDAsIHsgZXJyb3I6ICdJbnZhbGlkIEpTT04gaW4gcmVxdWVzdCBib2R5JyB9KTtcbiAgICB9XG4gICAgY29uc3QgdGV4dCA9IGJvZHkudGV4dDtcbiAgICBjb25zb2xlLmxvZygnSW5wdXQgdGV4dDonLCB0ZXh0LCAnVHlwZTonLCB0eXBlb2YgdGV4dCk7XG5cbiAgICBcbiAgICBpZiAoIXRleHQgfHwgdHlwZW9mIHRleHQgIT09ICdzdHJpbmcnKSB7XG4gICAgICByZXR1cm4gY3JlYXRlUmVzcG9uc2UoNDAwLCB7IGVycm9yOiAnVGV4dCBtdXN0IGJlIGEgc3RyaW5nJyB9KTtcbiAgICB9XG4gICAgaWYgKCFpc05hTihOdW1iZXIodGV4dCkpICYmIHRleHQudHJpbSgpICE9PSAnJykge1xuICAgICAgcmV0dXJuIGNyZWF0ZVJlc3BvbnNlKDQwMCwgeyBlcnJvcjogJ1RleHQgbXVzdCBub3QgYmUgYSBudW1iZXInIH0pO1xuICAgIH1cblxuICAgIGNvbnN0IHBheWxvYWQgPSBCdWZmZXIuZnJvbShKU09OLnN0cmluZ2lmeSh7IHRleHQgfSkpO1xuXG4gICAgY29uc3QgY29tbWFuZCA9IG5ldyBJbnZva2VFbmRwb2ludENvbW1hbmQoe1xuICAgICAgRW5kcG9pbnROYW1lOiBlbmRwb2ludE5hbWUsXG4gICAgICBCb2R5OiBwYXlsb2FkLFxuICAgICAgQ29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJyxcbiAgICAgIEFjY2VwdDogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgIH0pO1xuXG4gICAgY29uc29sZS5sb2coJ0ludm9raW5nIFNhZ2VNYWtlciBlbmRwb2ludDonLCBlbmRwb2ludE5hbWUpO1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNsaWVudC5zZW5kKGNvbW1hbmQpO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gSlNPTi5wYXJzZShuZXcgVGV4dERlY29kZXIoKS5kZWNvZGUocmVzdWx0LkJvZHkpKTtcblxuICAgIHJldHVybiBjcmVhdGVSZXNwb25zZSgyMDAsIHsgcmVzdWx0OiByZXNwb25zZSB9KTtcblxuICB9IFxuXG4gIGNhdGNoIChlcnJvcjogdW5rbm93bikge1xuICAgIC8vIEV4cGxpY2l0bHkgaGFuZGxlIHRoZSAndW5rbm93bicgdHlwZVxuICAgIGxldCBlcnJvck1lc3NhZ2U6IHN0cmluZztcbiAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgZXJyb3JNZXNzYWdlID0gZXJyb3IubWVzc2FnZTtcbiAgICB9IGVsc2Uge1xuICAgICAgZXJyb3JNZXNzYWdlID0gU3RyaW5nKGVycm9yKSB8fCAnVW5rbm93biBlcnJvcic7XG4gICAgfVxuXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgaW52b2tpbmcgU2FnZU1ha2VyIGVuZHBvaW50OicsIGVycm9yKTtcbiAgICByZXR1cm4gY3JlYXRlUmVzcG9uc2UoNTAwLCB7XG4gICAgICBlcnJvcjogJ0ZhaWxlZCB0byBpbnZva2UgbW9kZWwnLFxuICAgICAgZGV0YWlsczogZXJyb3JNZXNzYWdlLFxuICAgIH0pO1xuICB9XG59O1xuXG5mdW5jdGlvbiBjcmVhdGVSZXNwb25zZShzdGF0dXNDb2RlOiBudW1iZXIsIGJvZHk6IHsgZXJyb3I/OiBzdHJpbmc7IHJlc3VsdD86IGFueTsgZGV0YWlscz86IGFueTsgfSkge1xuICByZXR1cm4ge1xuICAgIHN0YXR1c0NvZGUsXG4gICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0sXG4gICAgYm9keTogSlNPTi5zdHJpbmdpZnkoYm9keSksXG4gIH07XG59XG5cblxuLypleHBvcnQgY29uc3QgaGFuZGxlciA9IGFzeW5jIChldmVudDogQVBJR2F0ZXdheVByb3h5RXZlbnQpOiBQcm9taXNlPEFQSUdhdGV3YXlQcm94eVJlc3VsdD4gPT4ge1xuXG4gIGNvbnN0IGVuZHBvaW50TmFtZSA9IHByb2Nlc3MuZW52LlNBR0VNQUtFUl9FTkRQT0lOVCB8fCBcImZsYXNrLWVuZHBvaW50XCI7IC8vIEZhbGxiYWNrIHRvIGZsYXNrLWVuZHBvaW50XG5cbiAgdHJ5IHtcbiAgICAvLyBWYWxpZGF0ZSBldmVudCBib2R5XG4gICAgaWYgKCFldmVudC5ib2R5KSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdGF0dXNDb2RlOiA0MDAsXG4gICAgICAgIGhlYWRlcnM6IHsgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBlcnJvcjogXCJObyByZXF1ZXN0IGJvZHkgcHJvdmlkZWRcIiB9KSxcbiAgICAgIH07XG4gICAgfVxuXG4gICAgLy8gUGFyc2UgdGhlIGJvZHkgYW5kIGV4dHJhY3QgJ3RleHQnIChtYXRjaGVzIEZsYXNrIGFwcCBleHBlY3RhdGlvbilcbiAgICBjb25zdCBib2R5ID0gSlNPTi5wYXJzZShldmVudC5ib2R5KTtcbiAgICBjb25zdCB0ZXh0ID0gYm9keS50ZXh0O1xuXG4gICAgaWYgKCF0ZXh0IHx8IHR5cGVvZiB0ZXh0ICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBzdGF0dXNDb2RlOiA0MDAsXG4gICAgICAgIGhlYWRlcnM6IHsgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIgfSxcbiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBlcnJvcjogXCJNaXNzaW5nIG9yIGludmFsaWQgJ3RleHQnIGluIHJlcXVlc3QgYm9keVwiIH0pLFxuICAgICAgfTtcbiAgICB9XG5cbiAgICAvLyBQcmVwYXJlIHRoZSBwYXlsb2FkIGZvciBTYWdlTWFrZXIgKG1hdGNoZXMgRmxhc2sgYXBwJ3MgaW5wdXRfZm4pXG4gICAgY29uc3QgcGF5bG9hZCA9IEpTT04uc3RyaW5naWZ5KHsgdGV4dCB9KTtcblxuICAgIC8vIEludm9rZSB0aGUgU2FnZU1ha2VyIGVuZHBvaW50XG4gICAgY29uc3QgcGFyYW1zID0ge1xuICAgICAgRW5kcG9pbnROYW1lOiBlbmRwb2ludE5hbWUsXG4gICAgICBCb2R5OiBwYXlsb2FkLFxuICAgICAgQ29udGVudFR5cGU6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgQWNjZXB0OiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgICB9O1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgY2xpZW50Lmludm9rZUVuZHBvaW50KHBhcmFtcykucHJvbWlzZSgpO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gSlNPTi5wYXJzZShyZXN1bHQuQm9keS50b1N0cmluZyhcInV0Zi04XCIpKTtcblxuICAgIHJldHVybiB7XG4gICAgICBzdGF0dXNDb2RlOiAyMDAsXG4gICAgICBoZWFkZXJzOiB7IFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiIH0sXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IHJlc3VsdDogcmVzcG9uc2UgfSksXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKFwiRXJyb3IgaW52b2tpbmcgU2FnZU1ha2VyIGVuZHBvaW50OlwiLCBlcnJvcik7XG4gICAgcmV0dXJuIHtcbiAgICAgIHN0YXR1c0NvZGU6IDUwMCxcbiAgICAgIGhlYWRlcnM6IHsgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIgfSxcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgZXJyb3I6IFwiRmFpbGVkIHRvIGludm9rZSBtb2RlbFwiLFxuICAgICAgICBkZXRhaWxzOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6IFwiVW5rbm93biBlcnJvclwiLFxuICAgICAgfSksXG4gICAgfTtcbiAgfVxufTsqLyJdfQ==